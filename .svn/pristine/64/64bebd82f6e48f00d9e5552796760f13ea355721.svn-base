
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/GameRankingList.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a0ea2Faum1JDKkSr0Ka631L', 'GameRankingList');
// Script/GameRankingList.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    rankingScrollView: cc.ScrollView,
    scrollViewContent: cc.Node,
    selfRankItem: cc.Node,
    prefabRankItem: cc.Prefab,
    prefabGameOverRank: cc.Prefab,
    gameOverRankNode: cc.Node,
    gameOverRankLayout: cc.Node,
    loadingLabel: cc.Node,
    //加载文字
    iconSpriteFrame: {
      "default": [],
      type: cc.SpriteFrame
    }
  },
  onLoad: function onLoad() {
    var _this = this;

    this.removeChild();
    this.CC_WECHATGAME = true;

    if (this.CC_WECHATGAME) {
      window.wx.onMessage(function (data) {
        console.log("接收主域发来消息：", data);

        if (data.messageType == 0) {
          //移除排行榜
          _this.removeChild();
        } else if (data.messageType == 1) {
          //获取好友排行榜
          _this.fetchFriendData();
        }
      });
    }
  },
  removeChild: function removeChild() {
    this.rankingScrollView.node.active = false;
    this.scrollViewContent.removeAllChildren();
    this.gameOverRankNode.active = false;
    this.gameOverRankLayout.removeAllChildren();
    this.loadingLabel.getComponent(cc.Label).string = "玩命加载中...";
    this.loadingLabel.active = true;
  },
  fetchFriendData: function fetchFriendData() {
    var _this2 = this;

    this.removeChild();
    this.rankingScrollView.node.active = true;

    if (this.CC_WECHATGAME) {
      wx.getUserInfo({
        openIdList: ['selfOpenId'],
        success: function success(userRes) {
          _this2.loadingLabel.active = false;
          console.log('success', userRes.data);
          var userData = userRes.data[0]; //取出所有好友数据

          wx.getFriendCloudStorage({
            keyList: ["nuoduidui"],
            success: function success(res) {
              console.log("wx.getFriendCloudStorage success", res);
              var data = res.data;
              data.sort(function (a, b) {
                if (a.KVDataList.length == 0 && b.KVDataList.length == 0) {
                  return 0;
                }

                if (a.KVDataList.length == 0) {
                  return 1;
                }

                if (b.KVDataList.length == 0) {
                  return -1;
                }

                return JSON.parse(b.KVDataList[0].value).score - JSON.parse(a.KVDataList[0].value).score;
              });

              _this2.scrollViewContent.removeAllChildren();

              for (var i = 0; i < data.length; i++) {
                var playerInfo = data[i];
                var item = cc.instantiate(_this2.prefabRankItem);
                item.getComponent('RankItem').init(i, playerInfo);

                _this2.scrollViewContent.addChild(item);

                _this2.selfRankItem.active = true;

                if (data[i].avatarUrl == userData.avatarUrl) {
                  var score = 0;

                  if (playerInfo.KVDataList.length != 0) {
                    if (JSON.parse(playerInfo.KVDataList[0].value).score == undefined) {
                      score = 0;
                    } else {
                      score = JSON.parse(playerInfo.KVDataList[0].value).score;
                    }
                  } else {
                    score = 0;
                  }

                  var level = 0;

                  if (playerInfo.KVDataList.length != 0) {
                    if (JSON.parse(playerInfo.KVDataList[0].value).level == undefined) {
                      level = 0;
                    } else {
                      level = JSON.parse(playerInfo.KVDataList[0].value).level;
                    }
                  } else {
                    level = 0;
                  }

                  if (i < 3) {
                    _this2.selfRankItem.getChildByName("img_rank1").active = true;
                    _this2.selfRankItem.getChildByName("img_rank1").getComponent(cc.Sprite).spriteFrame = _this2.iconSpriteFrame[i];
                    _this2.selfRankItem.getChildByName("rank").active = false;
                  } else {
                    _this2.selfRankItem.getChildByName("img_rank1").active = false;
                    _this2.selfRankItem.getChildByName("rank").active = true;
                    _this2.selfRankItem.getChildByName("rank").getComponent(cc.Label).string = 0 == i ? "100+" : i + 1 + "";
                  }

                  _this2.selfRankItem.getChildByName("score").getComponent(cc.Label).string = score;
                  _this2.selfRankItem.getChildByName("level").getComponent(cc.Label).string = "第" + level + "关";
                }
              }

              if (data.length <= 8) {
                var layout = _this2.scrollViewContent.getComponent(cc.Layout);

                layout.resizeMode = cc.Layout.ResizeMode.NONE;
              }
            },
            fail: function fail(res) {
              console.log("wx.getFriendCloudStorage fail", res); // this.selfRankItem.active = false;

              _this2.loadingLabel.getComponent(cc.Label).string = "好友排名未授权，无法查看";
            }
          });
        },
        fail: function fail(res) {
          console.log("wx.getFriendCloudStorage2 fail", res); // this.selfRankItem.active = false;

          _this2.loadingLabel.getComponent(cc.Label).string = "好友排名未授权，无法查看";
        }
      });
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxHYW1lUmFua2luZ0xpc3QuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJyYW5raW5nU2Nyb2xsVmlldyIsIlNjcm9sbFZpZXciLCJzY3JvbGxWaWV3Q29udGVudCIsIk5vZGUiLCJzZWxmUmFua0l0ZW0iLCJwcmVmYWJSYW5rSXRlbSIsIlByZWZhYiIsInByZWZhYkdhbWVPdmVyUmFuayIsImdhbWVPdmVyUmFua05vZGUiLCJnYW1lT3ZlclJhbmtMYXlvdXQiLCJsb2FkaW5nTGFiZWwiLCJpY29uU3ByaXRlRnJhbWUiLCJ0eXBlIiwiU3ByaXRlRnJhbWUiLCJvbkxvYWQiLCJyZW1vdmVDaGlsZCIsIkNDX1dFQ0hBVEdBTUUiLCJ3aW5kb3ciLCJ3eCIsIm9uTWVzc2FnZSIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwibWVzc2FnZVR5cGUiLCJmZXRjaEZyaWVuZERhdGEiLCJub2RlIiwiYWN0aXZlIiwicmVtb3ZlQWxsQ2hpbGRyZW4iLCJnZXRDb21wb25lbnQiLCJMYWJlbCIsInN0cmluZyIsImdldFVzZXJJbmZvIiwib3BlbklkTGlzdCIsInN1Y2Nlc3MiLCJ1c2VyUmVzIiwidXNlckRhdGEiLCJnZXRGcmllbmRDbG91ZFN0b3JhZ2UiLCJrZXlMaXN0IiwicmVzIiwic29ydCIsImEiLCJiIiwiS1ZEYXRhTGlzdCIsImxlbmd0aCIsIkpTT04iLCJwYXJzZSIsInZhbHVlIiwic2NvcmUiLCJpIiwicGxheWVySW5mbyIsIml0ZW0iLCJpbnN0YW50aWF0ZSIsImluaXQiLCJhZGRDaGlsZCIsImF2YXRhclVybCIsInVuZGVmaW5lZCIsImxldmVsIiwiZ2V0Q2hpbGRCeU5hbWUiLCJTcHJpdGUiLCJzcHJpdGVGcmFtZSIsImxheW91dCIsIkxheW91dCIsInJlc2l6ZU1vZGUiLCJSZXNpemVNb2RlIiwiTk9ORSIsImZhaWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFB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aUJBQUwsQ0FBdUIwQixZQUF2QixDQUFvQ2hDLEVBQUUsQ0FBQ2lFLE1BQXZDLENBQWI7O2dCQUNBRCxNQUFNLENBQUNFLFVBQVAsR0FBb0JsRSxFQUFFLENBQUNpRSxNQUFILENBQVVFLFVBQVYsQ0FBcUJDLElBQXpDO2NBQ0g7WUFDSixDQXZFb0I7WUF3RXJCQyxJQUFJLEVBQUUsY0FBQTNCLEdBQUcsRUFBSTtjQUNUakIsT0FBTyxDQUFDQyxHQUFSLENBQVksK0JBQVosRUFBNkNnQixHQUE3QyxFQURTLENBRVQ7O2NBQ0EsTUFBSSxDQUFDNUIsWUFBTCxDQUFrQmtCLFlBQWxCLENBQStCaEMsRUFBRSxDQUFDaUMsS0FBbEMsRUFBeUNDLE1BQXpDLEdBQWtELGNBQWxEO1lBQ0g7VUE1RW9CLENBQXpCO1FBOEVILENBckZVO1FBc0ZYbUMsSUFBSSxFQUFFLGNBQUMzQixHQUFELEVBQVM7VUFDWGpCLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGdDQUFaLEVBQThDZ0IsR0FBOUMsRUFEVyxDQUVYOztVQUNBLE1BQUksQ0FBQzVCLFlBQUwsQ0FBa0JrQixZQUFsQixDQUErQmhDLEVBQUUsQ0FBQ2lDLEtBQWxDLEVBQXlDQyxNQUF6QyxHQUFrRCxjQUFsRDtRQUNIO01BMUZVLENBQWY7SUE0Rkg7RUFDSjtBQS9JSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICByYW5raW5nU2Nyb2xsVmlldzogY2MuU2Nyb2xsVmlldyxcbiAgICAgICAgc2Nyb2xsVmlld0NvbnRlbnQ6IGNjLk5vZGUsXG4gICAgICAgIHNlbGZSYW5rSXRlbTogY2MuTm9kZSxcbiAgICAgICAgcHJlZmFiUmFua0l0ZW06IGNjLlByZWZhYixcbiAgICAgICAgcHJlZmFiR2FtZU92ZXJSYW5rOiBjYy5QcmVmYWIsXG4gICAgICAgIGdhbWVPdmVyUmFua05vZGU6IGNjLk5vZGUsXG4gICAgICAgIGdhbWVPdmVyUmFua0xheW91dDogY2MuTm9kZSxcbiAgICAgICAgbG9hZGluZ0xhYmVsOiBjYy5Ob2RlLC8v5Yqg6L295paH5a2XXG5cbiAgICAgICAgaWNvblNwcml0ZUZyYW1lOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBbXSxcbiAgICAgICAgICAgIHR5cGU6IGNjLlNwcml0ZUZyYW1lXG4gICAgICAgIH0sXG4gICAgfSxcblxuICAgIG9uTG9hZCgpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVDaGlsZCgpO1xuXG4gICAgICAgIHRoaXMuQ0NfV0VDSEFUR0FNRSA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLkNDX1dFQ0hBVEdBTUUpIHtcbiAgICAgICAgICAgIHdpbmRvdy53eC5vbk1lc3NhZ2UoZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLmjqXmlLbkuLvln5/lj5HmnaXmtojmga/vvJpcIiwgZGF0YSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5tZXNzYWdlVHlwZSA9PSAwKSB7Ly/np7vpmaTmjpLooYzmppxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChkYXRhLm1lc3NhZ2VUeXBlID09IDEpIHsvL+iOt+WPluWlveWPi+aOkuihjOamnFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZldGNoRnJpZW5kRGF0YSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbW92ZUNoaWxkKCkge1xuICAgICAgICB0aGlzLnJhbmtpbmdTY3JvbGxWaWV3Lm5vZGUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2Nyb2xsVmlld0NvbnRlbnQucmVtb3ZlQWxsQ2hpbGRyZW4oKTtcbiAgICAgICAgdGhpcy5nYW1lT3ZlclJhbmtOb2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdhbWVPdmVyUmFua0xheW91dC5yZW1vdmVBbGxDaGlsZHJlbigpO1xuICAgICAgICB0aGlzLmxvYWRpbmdMYWJlbC5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwi546p5ZG95Yqg6L295LitLi4uXCI7XG4gICAgICAgIHRoaXMubG9hZGluZ0xhYmVsLmFjdGl2ZSA9IHRydWU7XG4gICAgfSxcblxuICAgIGZldGNoRnJpZW5kRGF0YSgpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVDaGlsZCgpO1xuICAgICAgICB0aGlzLnJhbmtpbmdTY3JvbGxWaWV3Lm5vZGUuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuQ0NfV0VDSEFUR0FNRSkge1xuICAgICAgICAgICAgd3guZ2V0VXNlckluZm8oe1xuICAgICAgICAgICAgICAgIG9wZW5JZExpc3Q6IFsnc2VsZk9wZW5JZCddLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICh1c2VyUmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZ0xhYmVsLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3VjY2VzcycsIHVzZXJSZXMuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJEYXRhID0gdXNlclJlcy5kYXRhWzBdO1xuICAgICAgICAgICAgICAgICAgICAvL+WPluWHuuaJgOacieWlveWPi+aVsOaNrlxuICAgICAgICAgICAgICAgICAgICB3eC5nZXRGcmllbmRDbG91ZFN0b3JhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5TGlzdDogW1wibnVvZHVpZHVpXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInd4LmdldEZyaWVuZENsb3VkU3RvcmFnZSBzdWNjZXNzXCIsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSByZXMuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuS1ZEYXRhTGlzdC5sZW5ndGggPT0gMCAmJiBiLktWRGF0YUxpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLktWRGF0YUxpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLktWRGF0YUxpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShiLktWRGF0YUxpc3RbMF0udmFsdWUpLnNjb3JlIC0gSlNPTi5wYXJzZShhLktWRGF0YUxpc3RbMF0udmFsdWUpLnNjb3JlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Q29udGVudC5yZW1vdmVBbGxDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxheWVySW5mbyA9IGRhdGFbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtID0gY2MuaW5zdGFudGlhdGUodGhpcy5wcmVmYWJSYW5rSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZ2V0Q29tcG9uZW50KCdSYW5rSXRlbScpLmluaXQoaSwgcGxheWVySW5mbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVmlld0NvbnRlbnQuYWRkQ2hpbGQoaXRlbSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxmUmFua0l0ZW0uYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbaV0uYXZhdGFyVXJsID09IHVzZXJEYXRhLmF2YXRhclVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNjb3JlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJJbmZvLktWRGF0YUxpc3QubGVuZ3RoICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoSlNPTi5wYXJzZShwbGF5ZXJJbmZvLktWRGF0YUxpc3RbMF0udmFsdWUpLnNjb3JlID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZSA9IEpTT04ucGFyc2UocGxheWVySW5mby5LVkRhdGFMaXN0WzBdLnZhbHVlKS5zY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGV2ZWwgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllckluZm8uS1ZEYXRhTGlzdC5sZW5ndGggIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnBhcnNlKHBsYXllckluZm8uS1ZEYXRhTGlzdFswXS52YWx1ZSkubGV2ZWwgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsID0gSlNPTi5wYXJzZShwbGF5ZXJJbmZvLktWRGF0YUxpc3RbMF0udmFsdWUpLmxldmVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxmUmFua0l0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJpbWdfcmFuazFcIikuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGZSYW5rSXRlbS5nZXRDaGlsZEJ5TmFtZShcImltZ19yYW5rMVwiKS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuaWNvblNwcml0ZUZyYW1lW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZlJhbmtJdGVtLmdldENoaWxkQnlOYW1lKFwicmFua1wiKS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZlJhbmtJdGVtLmdldENoaWxkQnlOYW1lKFwiaW1nX3JhbmsxXCIpLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZlJhbmtJdGVtLmdldENoaWxkQnlOYW1lKFwicmFua1wiKS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZlJhbmtJdGVtLmdldENoaWxkQnlOYW1lKFwicmFua1wiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IDAgPT0gaSA/IFwiMTAwK1wiIDogKGkgKyAxKSArIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZlJhbmtJdGVtLmdldENoaWxkQnlOYW1lKFwic2NvcmVcIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBzY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZlJhbmtJdGVtLmdldENoaWxkQnlOYW1lKFwibGV2ZWxcIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBcIuesrFwiICsgbGV2ZWwgKyBcIuWFs1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA8PSA4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsYXlvdXQgPSB0aGlzLnNjcm9sbFZpZXdDb250ZW50LmdldENvbXBvbmVudChjYy5MYXlvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXQucmVzaXplTW9kZSA9IGNjLkxheW91dC5SZXNpemVNb2RlLk5PTkU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWw6IHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ3eC5nZXRGcmllbmRDbG91ZFN0b3JhZ2UgZmFpbFwiLCByZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuc2VsZlJhbmtJdGVtLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZ0xhYmVsLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gXCLlpb3lj4vmjpLlkI3mnKrmjojmnYPvvIzml6Dms5Xmn6XnnItcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInd4LmdldEZyaWVuZENsb3VkU3RvcmFnZTIgZmFpbFwiLCByZXMpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnNlbGZSYW5rSXRlbS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nTGFiZWwuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBcIuWlveWPi+aOkuWQjeacquaOiOadg++8jOaXoOazleafpeeci1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIl19