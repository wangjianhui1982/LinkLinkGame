
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/GameRankingList.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a0ea2Faum1JDKkSr0Ka631L', 'GameRankingList');
// Script/GameRankingList.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    rankingScrollView: cc.ScrollView,
    scrollViewContent: cc.Node,
    selfRankItem: cc.Node,
    prefabRankItem: cc.Prefab,
    prefabGameOverRank: cc.Prefab,
    gameOverRankNode: cc.Node,
    gameOverRankLayout: cc.Node,
    loadingLabel: cc.Node,
    //加载文字
    iconSpriteFrame: {
      "default": [],
      type: cc.SpriteFrame
    }
  },
  onLoad: function onLoad() {
    var _this = this;

    this.removeChild();
    this.CC_WECHATGAME = true;

    if (this.CC_WECHATGAME) {
      window.wx.onMessage(function (data) {
        console.log("接收主域发来消息：", data);

        if (data.messageType == 0) {
          //移除排行榜
          _this.removeChild();
        } else if (data.messageType == 1) {
          //获取好友排行榜
          _this.fetchFriendData();
        } else if (data.messageType == 4) {
          //获取好友排行榜横向排列展示模式
          _this.gameOverRank();
        }
      });
    }
  },
  removeChild: function removeChild() {
    this.rankingScrollView.node.active = false;
    this.scrollViewContent.removeAllChildren();
    this.gameOverRankNode.active = false;
    this.gameOverRankLayout.removeAllChildren();
    this.loadingLabel.getComponent(cc.Label).string = "玩命加载中...";
    this.loadingLabel.active = true;
  },
  fetchFriendData: function fetchFriendData() {
    var _this2 = this;

    this.removeChild();
    this.rankingScrollView.node.active = true;

    if (this.CC_WECHATGAME) {
      wx.getUserInfo({
        openIdList: ['selfOpenId'],
        success: function success(userRes) {
          _this2.loadingLabel.active = false;
          console.log('success', userRes.data);
          var userData = userRes.data[0]; //取出所有好友数据

          wx.getFriendCloudStorage({
            keyList: ["nuoduidui"],
            success: function success(res) {
              console.log("wx.getFriendCloudStorage success", res);
              var data = res.data;
              data.sort(function (a, b) {
                if (a.KVDataList.length == 0 && b.KVDataList.length == 0) {
                  return 0;
                }

                if (a.KVDataList.length == 0) {
                  return 1;
                }

                if (b.KVDataList.length == 0) {
                  return -1;
                }

                return b.KVDataList[0].value - a.KVDataList[0].value;
              });

              _this2.scrollViewContent.removeAllChildren();

              for (var i = 0; i < data.length; i++) {
                var playerInfo = data[i];
                var item = cc.instantiate(_this2.prefabRankItem);
                item.getComponent('RankItem').init(i, playerInfo);

                _this2.scrollViewContent.addChild(item);

                _this2.selfRankItem.active = true;

                if (data[i].avatarUrl == userData.avatarUrl) {
                  var grade = playerInfo.KVDataList.length != 0 ? playerInfo.KVDataList[0].value : 0;

                  if (i < 3) {
                    _this2.selfRankItem.getChildByName("img_rank1").active = true;
                    _this2.selfRankItem.getChildByName("img_rank1").getComponent(cc.Sprite).spriteFrame = _this2.iconSpriteFrame[i];
                    _this2.selfRankItem.getChildByName("rank").active = false;
                  } else {
                    _this2.selfRankItem.getChildByName("img_rank1").active = false;
                    _this2.selfRankItem.getChildByName("rank").active = true;
                    _this2.selfRankItem.getChildByName("rank").getComponent(cc.Label).string = 0 == i ? "100+" : i + 1 + "";
                  }

                  _this2.selfRankItem.getChildByName("score").getComponent(cc.Label).string = grade.toString();
                }
              }

              if (data.length <= 8) {
                var layout = _this2.scrollViewContent.getComponent(cc.Layout);

                layout.resizeMode = cc.Layout.ResizeMode.NONE;
              }
            },
            fail: function fail(res) {
              console.log("wx.getFriendCloudStorage fail", res); // this.selfRankItem.active = false;

              _this2.loadingLabel.getComponent(cc.Label).string = "好友排名未授权，无法查看";
            }
          });
        },
        fail: function fail(res) {
          console.log("wx.getFriendCloudStorage2 fail", res); // this.selfRankItem.active = false;

          _this2.loadingLabel.getComponent(cc.Label).string = "好友排名未授权，无法查看";
        }
      });
    }
  },
  gameOverRank: function gameOverRank() {
    var _this3 = this;

    this.removeChild();
    this.gameOverRankNode.active = true;

    if (this.CC_WECHATGAME) {
      wx.getUserInfo({
        openIdList: ['selfOpenId'],
        success: function success(userRes) {
          _this3.loadingLabel.active = false;
          console.log('success', userRes.data);
          var userData = userRes.data[0]; //取出所有好友数据

          wx.getFriendCloudStorage({
            keyList: ["nuoduidui"],
            success: function success(res) {
              console.log("wx.getFriendCloudStorage success", res);
              var data = res.data;
              data.sort(function (a, b) {
                if (a.KVDataList.length == 0 && b.KVDataList.length == 0) {
                  return 0;
                }

                if (a.KVDataList.length == 0) {
                  return 1;
                }

                if (b.KVDataList.length == 0) {
                  return -1;
                }

                return b.KVDataList[0].value - a.KVDataList[0].value;
              });

              _this3.gameOverRankLayout.removeAllChildren();

              for (var i = 0; i < data.length; i++) {
                var playerInfo = data[i];
                var userItem = cc.instantiate(_this3.prefabGameOverRank);
                userItem.getComponent('GameOverRank').init(i, playerInfo);

                _this3.gameOverRankLayout.addChild(userItem);
              }
            },
            fail: function fail(res) {
              console.log("wx.getFriendCloudStorage fail", res);
              _this3.gameOverRankNode.active = false;
              _this3.loadingLabel.getComponent(cc.Label).string = "好友排名未授权，无法查看";
            }
          });
        },
        fail: function fail(res) {
          console.log("wx.getFriendCloudStorage2 fail", res);
          _this3.gameOverRankNode.active = false;
          _this3.loadingLabel.getComponent(cc.Label).string = "好友排名未授权，无法查看";
        }
      });
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxHYW1lUmFua2luZ0xpc3QuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJyYW5raW5nU2Nyb2xsVmlldyIsIlNjcm9sbFZpZXciLCJzY3JvbGxWaWV3Q29udGVudCIsIk5vZGUiLCJzZWxmUmFua0l0ZW0iLCJwcmVmYWJSYW5rSXRlbSIsIlByZWZhYiIsInByZWZhYkdhbWVPdmVyUmFuayIsImdhbWVPdmVyUmFua05vZGUiLCJnYW1lT3ZlclJhbmtMYXlvdXQiLCJsb2FkaW5nTGFiZWwiLCJpY29uU3ByaXRlRnJhbWUiLCJ0eXBlIiwiU3ByaXRlRnJhbWUiLCJvbkxvYWQiLCJyZW1vdmVDaGlsZCIsIkNDX1dFQ0hBVEdBTUUiLCJ3aW5kb3ciLCJ3eCIsIm9uTWVzc2FnZSIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwibWVzc2FnZVR5cGUiLCJmZXRjaEZyaWVuZERhdGEiLCJnYW1lT3ZlclJhbmsiLCJub2RlIiwiYWN0aXZlIiwicmVtb3ZlQWxsQ2hpbGRyZW4iLCJnZXRDb21wb25lbnQiLCJMYWJlbCIsInN0cmluZyIsImdldFVzZXJJbmZvIiwib3BlbklkTGlzdCIsInN1Y2Nlc3MiLCJ1c2VyUmVzIiwidXNlckRhdGEiLCJnZXRGcmllbmRDbG91ZFN0b3JhZ2UiLCJrZXlMaXN0IiwicmVzIiwic29ydCIsImEiLCJiIiwiS1ZEYXRhTGlzdCIsImxlbmd0aCIsInZhbHVlIiwiaSIsInBsYXllckluZm8iLCJpdGVtIiwiaW5zdGFudGlhdGUiLCJpbml0IiwiYWRkQ2hpbGQiLCJhdmF0YXJVcmwiLCJncmFkZSIsImdldENoaWxkQnlOYW1lIiwiU3ByaXRlIiwic3ByaXRlRnJhbWUiLCJ0b1N0cmluZyIsImxheW91dCIsIkxheW91dCIsInJlc2l6ZU1vZGUiLCJSZXNpemVNb2RlIiwiTk9ORSIsImZhaWwiLCJ1c2VySXRlbSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFB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e1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgcmFua2luZ1Njcm9sbFZpZXc6IGNjLlNjcm9sbFZpZXcsXG4gICAgICAgIHNjcm9sbFZpZXdDb250ZW50OiBjYy5Ob2RlLFxuICAgICAgICBzZWxmUmFua0l0ZW06IGNjLk5vZGUsXG4gICAgICAgIHByZWZhYlJhbmtJdGVtOiBjYy5QcmVmYWIsXG4gICAgICAgIHByZWZhYkdhbWVPdmVyUmFuazogY2MuUHJlZmFiLFxuICAgICAgICBnYW1lT3ZlclJhbmtOb2RlOiBjYy5Ob2RlLFxuICAgICAgICBnYW1lT3ZlclJhbmtMYXlvdXQ6IGNjLk5vZGUsXG4gICAgICAgIGxvYWRpbmdMYWJlbDogY2MuTm9kZSwvL+WKoOi9veaWh+Wtl1xuXG4gICAgICAgIGljb25TcHJpdGVGcmFtZToge1xuICAgICAgICAgICAgZGVmYXVsdDogW10sXG4gICAgICAgICAgICB0eXBlOiBjYy5TcHJpdGVGcmFtZVxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICBvbkxvYWQoKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlQ2hpbGQoKTtcblxuICAgICAgICB0aGlzLkNDX1dFQ0hBVEdBTUUgPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy5DQ19XRUNIQVRHQU1FKSB7XG4gICAgICAgICAgICB3aW5kb3cud3gub25NZXNzYWdlKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5o6l5pS25Li75Z+f5Y+R5p2l5raI5oGv77yaXCIsIGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubWVzc2FnZVR5cGUgPT0gMCkgey8v56e76Zmk5o6S6KGM5qacXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGQoKTtcbiAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRhdGEubWVzc2FnZVR5cGUgPT0gMSkgey8v6I635Y+W5aW95Y+L5o6S6KGM5qacXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hGcmllbmREYXRhKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRhdGEubWVzc2FnZVR5cGUgPT0gNCkgey8v6I635Y+W5aW95Y+L5o6S6KGM5qac5qiq5ZCR5o6S5YiX5bGV56S65qih5byPXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZU92ZXJSYW5rKCk7XG4gICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbW92ZUNoaWxkKCkge1xuICAgICAgICB0aGlzLnJhbmtpbmdTY3JvbGxWaWV3Lm5vZGUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2Nyb2xsVmlld0NvbnRlbnQucmVtb3ZlQWxsQ2hpbGRyZW4oKTtcbiAgICAgICAgdGhpcy5nYW1lT3ZlclJhbmtOb2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdhbWVPdmVyUmFua0xheW91dC5yZW1vdmVBbGxDaGlsZHJlbigpO1xuICAgICAgICB0aGlzLmxvYWRpbmdMYWJlbC5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwi546p5ZG95Yqg6L295LitLi4uXCI7XG4gICAgICAgIHRoaXMubG9hZGluZ0xhYmVsLmFjdGl2ZSA9IHRydWU7XG4gICAgfSxcblxuICAgIGZldGNoRnJpZW5kRGF0YSgpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVDaGlsZCgpO1xuICAgICAgICB0aGlzLnJhbmtpbmdTY3JvbGxWaWV3Lm5vZGUuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuQ0NfV0VDSEFUR0FNRSkge1xuICAgICAgICAgICAgd3guZ2V0VXNlckluZm8oe1xuICAgICAgICAgICAgICAgIG9wZW5JZExpc3Q6IFsnc2VsZk9wZW5JZCddLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICh1c2VyUmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZ0xhYmVsLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3VjY2VzcycsIHVzZXJSZXMuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJEYXRhID0gdXNlclJlcy5kYXRhWzBdO1xuICAgICAgICAgICAgICAgICAgICAvL+WPluWHuuaJgOacieWlveWPi+aVsOaNrlxuICAgICAgICAgICAgICAgICAgICB3eC5nZXRGcmllbmRDbG91ZFN0b3JhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5TGlzdDogW1wibnVvZHVpZHVpXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInd4LmdldEZyaWVuZENsb3VkU3RvcmFnZSBzdWNjZXNzXCIsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSByZXMuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuS1ZEYXRhTGlzdC5sZW5ndGggPT0gMCAmJiBiLktWRGF0YUxpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLktWRGF0YUxpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLktWRGF0YUxpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYi5LVkRhdGFMaXN0WzBdLnZhbHVlIC0gYS5LVkRhdGFMaXN0WzBdLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Q29udGVudC5yZW1vdmVBbGxDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxheWVySW5mbyA9IGRhdGFbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtID0gY2MuaW5zdGFudGlhdGUodGhpcy5wcmVmYWJSYW5rSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZ2V0Q29tcG9uZW50KCdSYW5rSXRlbScpLmluaXQoaSwgcGxheWVySW5mbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVmlld0NvbnRlbnQuYWRkQ2hpbGQoaXRlbSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxmUmFua0l0ZW0uYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbaV0uYXZhdGFyVXJsID09IHVzZXJEYXRhLmF2YXRhclVybCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZ3JhZGUgPSBwbGF5ZXJJbmZvLktWRGF0YUxpc3QubGVuZ3RoICE9IDAgPyBwbGF5ZXJJbmZvLktWRGF0YUxpc3RbMF0udmFsdWUgOiAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGZSYW5rSXRlbS5nZXRDaGlsZEJ5TmFtZShcImltZ19yYW5rMVwiKS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZlJhbmtJdGVtLmdldENoaWxkQnlOYW1lKFwiaW1nX3JhbmsxXCIpLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gdGhpcy5pY29uU3ByaXRlRnJhbWVbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxmUmFua0l0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJyYW5rXCIpLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxmUmFua0l0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJpbWdfcmFuazFcIikuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxmUmFua0l0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJyYW5rXCIpLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxmUmFua0l0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJyYW5rXCIpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gMCA9PSBpID8gXCIxMDArXCIgOiAoaSArIDEpICsgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxmUmFua0l0ZW0uZ2V0Q2hpbGRCeU5hbWUoXCJzY29yZVwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGdyYWRlLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoIDw9IDgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxheW91dCA9IHRoaXMuc2Nyb2xsVmlld0NvbnRlbnQuZ2V0Q29tcG9uZW50KGNjLkxheW91dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dC5yZXNpemVNb2RlID0gY2MuTGF5b3V0LlJlc2l6ZU1vZGUuTk9ORTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbDogcmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInd4LmdldEZyaWVuZENsb3VkU3RvcmFnZSBmYWlsXCIsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5zZWxmUmFua0l0ZW0uYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nTGFiZWwuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBcIuWlveWPi+aOkuWQjeacquaOiOadg++8jOaXoOazleafpeeci1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmYWlsOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwid3guZ2V0RnJpZW5kQ2xvdWRTdG9yYWdlMiBmYWlsXCIsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuc2VsZlJhbmtJdGVtLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmdMYWJlbC5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwi5aW95Y+L5o6S5ZCN5pyq5o6I5p2D77yM5peg5rOV5p+l55yLXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2FtZU92ZXJSYW5rKCkge1xuICAgICAgICB0aGlzLnJlbW92ZUNoaWxkKCk7XG4gICAgICAgIHRoaXMuZ2FtZU92ZXJSYW5rTm9kZS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy5DQ19XRUNIQVRHQU1FKSB7XG4gICAgICAgICAgICB3eC5nZXRVc2VySW5mbyh7XG4gICAgICAgICAgICAgICAgb3BlbklkTGlzdDogWydzZWxmT3BlbklkJ10sXG4gICAgICAgICAgICAgICAgc3VjY2VzczogKHVzZXJSZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nTGFiZWwuYWN0aXZlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N1Y2Nlc3MnLCB1c2VyUmVzLmRhdGEpXG4gICAgICAgICAgICAgICAgICAgIGxldCB1c2VyRGF0YSA9IHVzZXJSZXMuZGF0YVswXTtcbiAgICAgICAgICAgICAgICAgICAgLy/lj5blh7rmiYDmnInlpb3lj4vmlbDmja5cbiAgICAgICAgICAgICAgICAgICAgd3guZ2V0RnJpZW5kQ2xvdWRTdG9yYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleUxpc3Q6IFtcIm51b2R1aWR1aVwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ3eC5nZXRGcmllbmRDbG91ZFN0b3JhZ2Ugc3VjY2Vzc1wiLCByZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gcmVzLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLktWRGF0YUxpc3QubGVuZ3RoID09IDAgJiYgYi5LVkRhdGFMaXN0Lmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5LVkRhdGFMaXN0Lmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi5LVkRhdGFMaXN0Lmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIuS1ZEYXRhTGlzdFswXS52YWx1ZSAtIGEuS1ZEYXRhTGlzdFswXS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZU92ZXJSYW5rTGF5b3V0LnJlbW92ZUFsbENoaWxkcmVuKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwbGF5ZXJJbmZvID0gZGF0YVtpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJJdGVtID0gY2MuaW5zdGFudGlhdGUodGhpcy5wcmVmYWJHYW1lT3ZlclJhbmspO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySXRlbS5nZXRDb21wb25lbnQoJ0dhbWVPdmVyUmFuaycpLmluaXQoaSwgcGxheWVySW5mbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZU92ZXJSYW5rTGF5b3V0LmFkZENoaWxkKHVzZXJJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsOiByZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwid3guZ2V0RnJpZW5kQ2xvdWRTdG9yYWdlIGZhaWxcIiwgcmVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWVPdmVyUmFua05vZGUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nTGFiZWwuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBcIuWlveWPi+aOkuWQjeacquaOiOadg++8jOaXoOazleafpeeci1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmYWlsOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwid3guZ2V0RnJpZW5kQ2xvdWRTdG9yYWdlMiBmYWlsXCIsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZU92ZXJSYW5rTm9kZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nTGFiZWwuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBcIuWlveWPi+aOkuWQjeacquaOiOadg++8jOaXoOazleafpeeci1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIl19